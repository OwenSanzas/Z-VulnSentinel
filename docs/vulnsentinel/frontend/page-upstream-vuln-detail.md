# 上游漏洞详情页 — Upstream Vulnerability Detail

> 路由: `/upstream-vuln/:id`
> 数据来源：upstream_vulns 表

从库详情页 Upstream Vulnerabilities 表中点击漏洞行进入，或从客户漏洞详情页点击上游漏洞引用进入。

```
┌──────────────────────────────────────────────────────────────────────────────────┐
│  ◉ VulnSentinel                                                O2Lab  │  Admin ▾ │
├──────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  ← Back                                                                          │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │  UPSTREAM VULNERABILITY #42                              status: published  │ │
│  │  Library: zlib/zlib                                                         │ │
│  │  Trigger: commit a1b2c3d                                                    │ │
│  │  Vuln Type: Buffer Over-read (CWE-126)                                      │ │
│  │  Severity: HIGH                                                             │ │
│  │  Affected Versions: < v1.3.2                                                │ │
│  │  Detected: 2026-02-15 14:32    Published: 2026-02-15 14:35                  │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│  AI Reasoning                                                                    │
│  ────────────────────────────────────────────────────────────────────────────     │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │  该 commit 在 deflate.c 的 inflate_fast() 中增加了输入长度与窗口大小的        │ │
│  │  边界检查。修复前，当 input len 超过 window size 时，memcpy 会读取越界        │ │
│  │  内存。这是一个典型的 buffer over-read 漏洞。                                 │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│  Diff                                                                            │
│  ────────────────────────────────────────────────────────────────────────────     │
│                                                                                  │
│  deflate.c                                                                       │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │  @@ -1042,6 +1042,8 @@ local int inflate_fast(strm, start)                  │ │
│  │       if (copy > have) copy = have;                                          │ │
│  │  +    if (copy > wnext)                                                      │ │
│  │  +        copy = wnext;                                                      │ │
│  │       zmemcpy(put, next, copy);                                              │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│  Upstream PoC                                                                    │
│  ────────────────────────────────────────────────────────────────────────────     │
│                                                                                  │
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │  Source: oss-fuzz issue #58234                                               │ │
│  │  Reproducer: clusterfuzz-testcase-minimized-zlib-deflate-58234               │ │
│  │  Status: collected ✅                                                        │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
│                                                                                  │
│  Client Impact                                                            (3)    │
│  ────────────────────────────────────────────────────────────────────────────     │
│                                                                                  │
│  ┌──────────────┬──────────────┬───────────────┬────────────┬────────────────┐   │
│  │ Project      │ Version Used │ Affected?     │ Status     │ Last Updated   │   │
│  ├──────────────┼──────────────┼───────────────┼────────────┼────────────────┤   │
│  │ ProjA →      │ v1.3.1       │ ⚠ YES         │ reported   │ 1 hour ago     │   │
│  ├──────────────┼──────────────┼───────────────┼────────────┼────────────────┤   │
│  │ ProjB →      │ v1.3.0       │ ⚠ YES         │ recorded   │ 30 min ago     │   │
│  ├──────────────┼──────────────┼───────────────┼────────────┼────────────────┤   │
│  │ ProjC →      │ v1.3.2       │ ✅ NO          │ not_affect │ 25 min ago     │   │
│  └──────────────┴──────────────┴───────────────┴────────────┴────────────────┘   │
│                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────┘
```

## 区域说明

| 区域 | 数据来源 | 说明 |
|------|----------|------|
| **漏洞信息头** | upstream_vulns 表 | 漏洞 ID、所属库、触发 commit、漏洞类型、严重程度、受影响版本、状态、时间戳 |
| **AI Reasoning** | upstream_vulns 表 | AI 对该漏洞的详细分析推理过程 |
| **Diff** | 实时 GitHub API | 触发 commit 的代码变更，高亮关键修复行 |
| **Upstream PoC** | upstream_vulns 表 | 从上游收集到的 PoC（oss-fuzz issue、regression test 等），如有 |
| **Client Impact** | client_vulns 表 + 分析流水线 | 所有客户项目对该漏洞的影响情况和当前状态 |

## Error 状态展示

当 `status=error` 时，漏洞信息头下方显示红色错误提示：

```
│  ┌──────────────────────────────────────────────────────────────────────────────┐ │
│  │  ❌ Error: GitHub API rate limit exceeded, failed to fetch diff             │ │
│  └──────────────────────────────────────────────────────────────────────────────┘ │
```

## Client Impact 状态

Client Impact 表的 Status 列显示两种情况：

- **分析进行中**（pipeline 状态）：`pending` / `path_searching` / `poc_generating` / `verified` / `not_affect` / `error`
- **分析完成**（client_vuln 状态）：`recorded` / `reported` / `confirmed` / `fixed` / `not_affect`

点击项目名进入该条 client_vuln 的详情页。

## 交互

| 操作 | 跳转 |
|------|------|
| 点击 `← Back` | 返回上一页（浏览器 history.back） |
| 点击信息头中 Library 名 | [库详情页](page-library-detail.md) |
| 点击信息头中 Trigger commit | [事件详情页](page-event-detail.md) |
| 点击 Client Impact 表中 Project 名 | [客户漏洞详情页](page-client-vuln-detail.md) |
